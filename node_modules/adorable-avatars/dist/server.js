'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _express = require('express');

var _express2 = _interopRequireDefault(_express);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _serveFavicon = require('serve-favicon');

var _serveFavicon2 = _interopRequireDefault(_serveFavicon);

var _findPort = require('find-port');

var _findPort2 = _interopRequireDefault(_findPort);

require('colors');

var _avatars = require('./routes/avatars');

var _avatars2 = _interopRequireDefault(_avatars);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var app = (0, _express2.default)();
var basePath = _path2.default.join(__dirname, '..');
var faviconPath = _path2.default.join(basePath, 'src', 'favicon.ico');

app.use((0, _serveFavicon2.default)(faviconPath));

app.use('/avatars', _avatars2.default);

var listen = function listen(port) {
  app.listen(port, function () {
    var _address = this.address(),
        address = _address.address;
    // eslint-disable-next-line no-console


    console.log(('[Adorable Avatars] Running at: http://' + address + ':' + port).green);
  });
};

var port = process.env.PORT || 3002;

if (port > 3002) {
  listen(port);
} else {
  (0, _findPort2.default)(port, port + 100, function (ports) {
    return listen(ports[0]);
  });
}

exports.default = app;